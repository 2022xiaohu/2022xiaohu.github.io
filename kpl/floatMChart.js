var floatMChart=function(){function a(a,t){var e=this;e.JQElment=a;e.font="Microsoft YaHei, Arial, Helvetica, sans-serif";e.JQElment.addClass("qlgMChart");e.stockType=t.stockType?t.stockType:"stock";e.hasAvg=t.hasAvg==false?false:true;e.initCanvas("init");e.BGLine();e.setData(t.data);e.drawMLine();e.event()}var t=a.prototype;t.initCanvas=function(a){var t=this;(function(){var e=t.gi(t.JQElment.innerWidth()),i=t.gi(t.JQElment.innerHeight());t.w=e-1;t.h=i-1;t.padding={l:50,r:55,t:25,b:0};t.r_h=t.h-(t.padding.t+t.padding.b);t.r_w=t.w-(t.padding.l+t.padding.r);t.tcH=t.gi(t.r_h*.68);t.dcH=20;t.bsY=t.tcH+t.dcH+t.padding.t;t.bcH=t.h-t.bsY-t.padding.b;t.nSpace=t.r_w/242;if(a=="init"){var n='<canvas data-c="bg" width="'+e+'" height="'+i+'" ></canvas>'+'<canvas data-c="ml" width="'+e+'" height="'+i+'" ></canvas>'+'<canvas data-c="gt" width="'+e+'" height="'+i+'" ></canvas>';t.JQElment.html(n)}else{t.JQElment.find("canvas").attr("width",t.w).attr("height",t.h+1)}t.ctxBGElem=t.JQElment.children('canvas[data-c="bg"]');t.ctxBG=t.ctxBGElem[0].getContext("2d");t.ctxLineElem=t.JQElment.children('canvas[data-c="ml"]');t.ctxLine=t.ctxLineElem[0].getContext("2d");t.ctxMoveElem=t.JQElment.children('canvas[data-c="gt"]');t.ctxMove=t.ctxMoveElem[0].getContext("2d");t.ctxBG.translate(.5,.5);t.ctxLine.translate(.5,.5);t.ctxMove.translate(.5,.5)})()};t.BGLine=function(){var a=this;var t=a.ctxBG;(function(){t.beginPath();t.fillStyle="#f5f5f5";var e=a.padding.l,i=a.tcH+a.padding.t,n=a.r_w,d=a.dcH;t.rect(e,i,n,d);t.fill();t.closePath()})();(function(){t.beginPath();t.lineWidth=.5;t.strokeStyle="#ddd";var e=[];e.push(a.tcH/2+a.padding.t);e.push(a.tcH+a.padding.t);e.push(a.bsY);var i=e.length;for(var n=0;n<i;n++){var d=a.gi(e[n]);t.moveTo(a.padding.l,d);t.lineTo(a.w-a.padding.r,d)}var l=a.gi(a.r_w/2+a.padding.l);t.moveTo(l,a.padding.t);t.lineTo(l,a.tcH+a.padding.t);t.moveTo(l,a.bsY);t.lineTo(l,a.h-a.padding.b);t.rect(a.padding.l,a.padding.t,a.r_w,a.r_h);var r=a.gi(a.tcH/8);var o=a.gi(a.bcH/3);var f=[];for(var n=1;n<8;n++){if(n==4)continue;f.push(n*r+a.padding.t)}f.push(o+a.bsY);f.push(o*2+a.bsY);for(var n=0;n<f.length;n++){a.DrawDotted(t,a.padding.l,f[n],a.w-a.padding.r,f[n])}var s=a.gi(a.r_w/4);var c=s+a.padding.l;a.DrawDotted(t,c,a.padding.t,c,a.tcH+a.padding.t);a.DrawDotted(t,c,a.bsY,c,a.h-a.padding.b);c=s*3+a.padding.l;a.DrawDotted(t,c,a.padding.t,c,a.tcH+a.padding.t);a.DrawDotted(t,c,a.bsY,c,a.h-a.padding.b);t.stroke();t.closePath()})();(function(){t.beginPath();t.font=12+"px "+a.font;t.textBaseline="middle";t.textAlign="left";var e=4,i=a.bsY-a.dcH/2,n=a.gi(a.r_w/4);t.fillStyle="#555";t.fillText("09:30",e+a.padding.l,i);t.textAlign="center";t.fillText("10:30",n+a.padding.l,i);t.fillText("11:30/13:00",n*2+a.padding.l,i);t.fillText("14:30",n*3+a.padding.l,i);t.textAlign="right";t.fillText("15:00",a.w-e-a.padding.r,i)})()};t.setData=function(a){var t=this;var e={time:[],day:[],avg:[],amo:[],bs:[],yp:a.yp,hp:10,lp:10,date:a.date};if(!a.list)a.list=[];var i=a.list.length;for(var n=0;n<i;n++){var d=a.list[n];e.time.push(d[0]);e.day.push(d[1]);e.avg.push(d[2]);e.amo.push(d[3]);e.bs.push(d[4])}var l=Math.max.apply(Math,e.day),r=Math.min.apply(Math,e.day),o=Math.max.apply(Math,e.avg),f=Math.min.apply(Math,e.avg);if(Math.abs(l)==Infinity)l=e.yp;if(Math.abs(r)==Infinity)r=e.yp;if(Math.abs(o)==Infinity)o=e.yp;if(Math.abs(f)==Infinity)f=e.yp;(function(){var a,i;if(t.hasAvg){a=l>o?l:o;i=r<f?r:f}else{a=l;i=r}var n=Math.abs(e.yp-a),d=Math.abs(e.yp-i);if(n>d){e.hp=a;e.lp=e.yp-n}else if(n==d){e.hp=e.yp+n;e.lp=e.yp-n}else{e.hp=e.yp+d;e.lp=i}})();e.maxDiff=function(){var a;var t=Math.abs(e.yp-l),i=Math.abs(e.yp-r);if(t>i){a=t}else{a=i}return a}();this.data=e};t.drawMLine=function(){var a=this,t=a.ctxLine;a.clearCanvas(a.ctxLineElem,-1,-1,a.w+2,a.h+2);if(a.data.day.length==0)return;(function(){var e=function(t){var e=a.tcH-(t-a.data.lp)/(a.data.hp-a.data.lp)*a.tcH;if(a.data.hp-a.data.lp==0)e=a.tcH/2;return a.gi(e+a.padding.t)};t.beginPath();t.lineWidth=1;t.lineJoin="bevel";t.strokeStyle="#1fa3c9";var i=false,n=a.data.day.length,d,l,r;for(var o=0;o<n;o++){var f=a.data.day[o];if(f>0){var s=a.gi(o*a.nSpace+a.nSpace/2+a.padding.l),c=e(f);if(d==undefined){d=s;l=c}r=s;if(!i){i=true;t.moveTo(s,c)}else t.lineTo(s,c)}}t.stroke();if(i){t.lineTo(r,a.tcH+a.padding.t);t.lineTo(d,a.tcH+a.padding.t);t.lineTo(d,l);t.fillStyle="rgba(214,232,255,0.5)";t.fill()}t.closePath();t.beginPath();t.strokeStyle="#ffa500";var i=false,n=a.data.avg.length;for(var o=0;o<n;o++){var f=a.data.avg[o];if(f>0){var s=a.gi(o*a.nSpace+a.nSpace/2+a.padding.l),c=e(f);if(!i){i=true;t.moveTo(s,c)}else t.lineTo(s,c)}}t.stroke();t.closePath()})();(function(){var e=Math.max.apply(Math,a.data.amo),i=a.gi(a.nSpace*.7),n=(a.nSpace-i)/2;var d=function(t){var i=a.bcH*t/e;return i};var l=function(e){t.beginPath();if(e==0)t.fillStyle="#306612";else if(e==1)t.fillStyle="#e93030";else if(e==2)t.fillStyle="#737373";var l=a.data.amo.length;for(var r=0;r<l;r++){var o=a.data.amo[r],f=a.data.bs[r];if(f!=e)continue;x=r*a.nSpace+n+a.padding.l;h=d(o);y=a.h-h;t.rect(x,y,i,h)}t.fill();t.closePath()};l(0);l(1);l(2)})();(function(){var e=4;t.beginPath();t.textBaseline="middle";t.font=12+"px "+a.font;var i=a.padding.l-e,n=a.w-a.padding.r+e;(function(){var e=a.data.yp+a.data.maxDiff,d=a.data.yp-a.data.maxDiff,l=(e-a.data.yp)/a.data.yp*100,r=(d-a.data.yp)/a.data.yp*100,o=9,f=(e-d)/(o-1),s=(l-r)/(o-1),c=a.tcH/(o-1);for(var h=0;h<o;h++){var v=h*c+a.padding.t;var p=e-h*f,g=l-h*s;if(h==4){p=a.data.yp;g=0}p=p.toFixed(2);if(g>0){g="+"+g.toFixed(2)+"%";t.fillStyle="#e50012"}else if(g<0){g=g.toFixed(2)+"%";t.fillStyle="#008300"}else{g=g.toFixed(2)+"%";t.fillStyle="#000"}t.textAlign="right";t.fillText(p,i,v);t.textAlign="left";t.fillText(g,n,v)}})();(function(){t.fillStyle="#545454";t.textAlign="right";var e=Math.max.apply(Math,a.data.amo),n=4,d=e/(n-1),l=a.bcH/(n-1);for(var r=0;r<n;r++){var o=r*l+a.bsY;var f=e-r*d;if(f>1e8){f=(f/1e8).toFixed(2)+"亿"}else if(f>1e4){f/=1e4;if(f>999)f=f.toFixed(0);else if(f>99)f=f.toFixed(1);else f=f.toFixed(2);f+="万"}else f=f.toFixed(0);if(r==n-1){t.textBaseline="bottom";o+=2}t.fillText(f,i,o)}})()})();a.drawCheckedInfo(-1,false)};t.drawRulerLine=function(a,t){var e=this;var i=e.ctxMove;e.clearCanvas(e.ctxMoveElem,-1,-1,e.w+2,e.h+2);var n=Math.round((a-e.padding.l)/e.nSpace),d=e.data.day[n];if(!d){e.eventParam.hasChecked=false;e.drawCheckedInfo(-1,false);return}else{e.eventParam.hasChecked={x:a,y:t,index:n}}var l=e.gi(n*e.nSpace+e.nSpace/2+e.padding.l),r=function(){var a=e.tcH-(d-e.data.lp)/(e.data.hp-e.data.lp)*e.tcH+e.padding.t;return e.gi(a)}();i.beginPath();i.lineWidth=1;i.strokeStyle="#858585";i.moveTo(e.padding.l,r);i.lineTo(e.w-e.padding.r,r);i.moveTo(l,e.padding.t);i.lineTo(l,e.h-e.padding.b);i.stroke();i.closePath();(function(){i.beginPath();i.lineWidth=.5;i.strokeStyle="#858585";i.fillStyle="rgba(240,235,235,0.9)";var a=18,t=4;var n=(d-e.data.yp)/e.data.yp*100;var l="#000";if(n>0){n="+"+n.toFixed(2)+"%";l="#e50012"}else if(n<0){n=n.toFixed(2)+"%";l="#008300"}else{l="#000"}var o=i.measureText(d).width+t*2,f=i.measureText(n).width+t*2;var s=e.padding.l-o,c=r-a/2,h=e.w-e.padding.r,v=c;i.rect(s,c,o,a);i.rect(h,v,f,a);i.fill();i.stroke();i.beginPath();i.fillStyle=l;i.textBaseline="middle";i.textAlign="center";i.fillText(d,s+o/2,r);i.fillText(n,h+f/2,r)})();e.drawCheckedInfo(n,false)};t.reDrawSectionLen=function(a){var t=this;if(!a||a<0)a=0;else if(a>49)a=49;t.scale.len=a;if(t.scale.OPtionState!=2){t.drawScale(t.scale.OPtionState)}};t.DrawDotted=function(a,t,e,i,n){var d=2,l=3;var r=Math.abs(i-t),o=Math.abs(n-e),f=Math.sqrt(Math.pow(r,2)+Math.pow(o,2));var s=d*r/f,c=d*o/f,h=l*r/f,v=l*o/f;var p=f/(d+l);for(var g=0;g<p;g++){var x=(s+h)*g+t,y=(c+v)*g+e,u=x+s,m=y+c;x=this.gi(x);y=this.gi(y);u=this.gi(u);m=this.gi(m);a.moveTo(x,y);a.lineTo(u,m)}};t.gi=function(a){var t=.5+a|0;t=.5+a;t=.5+a<<0;return t};t.clearCanvas=function(a,t,e,i,n){a[0].getContext("2d").clearRect(t,e,i,n);a.hide();a[0].offsetHeight;a.show()};t.drawCheckedInfo=function(a,t){var e=this;var i=e.ctxMove;if(t)e.clearCanvas(e.ctxMoveElem,-1,-1,e.w+2,e.h+2);var n=e.data.day[a];if(!n){if(e.data.day.length>0){a=e.data.day.length-1;n=e.data.day[a]}else return}i.beginPath();i.font=12+"px "+e.font;i.fillStyle="rgba(255,255,255,0.8)";i.strokeStyle="#c5d0ff";var d=4,l=4,r=18,o=6;var f=function(){var a=e.data.date.split("-");return a[1]+"-"+a[2]}(),s=function(){var a=new Date(e.data.date.replace(/-/g,"/"));var t=a.getDay();if(t==0)t="周日";else if(t==1)t="周一";else if(t==2)t="周二";else if(t==3)t="周三";else if(t==4)t="周四";else if(t==5)t="周五";else if(t==6)t="周六";return t}(),c=e.data.time[a],h=e.data.avg[a].toFixed(2),v=n-e.data.yp,p=v.toFixed(2),g=(100*(n-e.data.yp)/e.data.yp).toFixed(2)+"%",x=function(){var t=e.data.amo[a];if(t>1e8)t=(t/1e8).toFixed(2)+"亿";else if(t>1e4)t=(t/1e4).toFixed(2)+"万";else t=t.toFixed(0);return t+"(手)"}(),y=e.changeBigDetail(e.data.amo[a]*100*n);var u=e.padding.l,m=l+r/2-1;var b="#999";i.textBaseline="middle";i.textAlign="left";var w=u;var M=function(a,t,e){i.fillStyle=t;i.fillText(a,w,m);w+=i.measureText(a).width+e};M(f,b,o);M(s,b,o);M(c,b,o);M((e.stockType=="plate"?"点数：":"价格：")+n,b,o);M("成交量："+x,b,o);if(e.stockType!="plate")M("均价："+h,b,o)};t.changeBigDetail=function(a){var t=parseFloat(a);if(t>99999999){t=t/1e8;if(t>9999)t=(t/1e4).toFixed(2)+"万";else t=t.toFixed(2);t+="亿"}else if(t>9999)t=(t/1e4).toFixed(2)+"万";else t=t.toFixed(2);return t};t.event=function(){var a=this;a.eventParam={};a.JQElment.find('canvas[data-c="gt"]').on("mousemove",function(t){var e=t.offsetX,i=t.offsetY;a.drawRulerLine(e,i)}).on("mouseout",function(t){var e=a.ctxMove;a.eventParam.hasChecked=false;a.drawCheckedInfo(-1,true)})};return a}();